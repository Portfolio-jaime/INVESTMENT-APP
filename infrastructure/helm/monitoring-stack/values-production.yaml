# Production values for monitoring stack
global:
  imageRegistry: "trii-registry.azurecr.io"
  storageClass: "premium-ssd"
  domain: "trii.co"
  environment: "production"

# Enhanced Prometheus configuration for production
kube-prometheus-stack:
  prometheus:
    prometheusSpec:
      # Increased resources for production load
      resources:
        requests:
          memory: 4Gi
          cpu: 1000m
        limits:
          memory: 8Gi
          cpu: 2000m
      
      # Larger storage for production metrics
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: premium-ssd
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 100Gi
      
      # Extended retention for production
      retention: "60d"
      retentionSize: "90GB"
      
      # High availability
      replicas: 2
      
      # Enhanced security
      securityContext:
        runAsNonRoot: true
        runAsUser: 65534
        fsGroup: 65534
      
      # Production external labels
      externalLabels:
        cluster: trii-production
        environment: production
        region: us-east-1

  # AlertManager HA configuration
  alertmanager:
    alertmanagerSpec:
      # HA setup
      replicas: 3
      
      # Production resources
      resources:
        requests:
          memory: 512Mi
          cpu: 200m
        limits:
          memory: 1Gi
          cpu: 500m
      
      # Larger storage
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: premium-ssd
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 20Gi

  # Grafana production configuration
  grafana:
    # Production resources
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
    
    # Larger persistence
    persistence:
      size: 20Gi
    
    # Production Grafana settings
    grafana.ini:
      server:
        root_url: https://grafana.trii.co
        enforce_domain: true
      security:
        admin_user: admin
        cookie_secure: true
        cookie_samesite: strict
        strict_transport_security: true
        x_frame_options: DENY
        x_content_type_options: true
        x_xss_protection: true
      auth:
        disable_login_form: false
        oauth_auto_login: false
      session:
        provider: redis
        provider_config: addr=redis.trii-monitoring.svc.cluster.local:6379,pool_size=100,db=0
      database:
        type: postgres
        host: postgres.trii-monitoring.svc.cluster.local:5432
        name: grafana
        user: grafana
        password: $__file{/etc/secrets/db-password}
        ssl_mode: require
      smtp:
        enabled: true
        host: smtp-relay.trii.co:587
        user: grafana@trii.co
        password: $__file{/etc/secrets/smtp-password}
        from_address: grafana@trii.co
        from_name: TRII Grafana
        startTLS_policy: MandatoryStartTLS

# Enhanced Loki configuration for production
loki-stack:
  loki:
    # Production resources
    resources:
      requests:
        memory: 2Gi
        cpu: 500m
      limits:
        memory: 4Gi
        cpu: 1000m
    
    # Larger storage
    persistence:
      size: 100Gi
    
    # Production Loki configuration
    config:
      auth_enabled: true
      server:
        http_listen_port: 3100
        grpc_listen_port: 9095
        log_level: info
      
      # Object storage for production (S3)
      storage_config:
        aws:
          region: us-east-1
          bucketnames: trii-loki-chunks
          access_key_id: ${AWS_ACCESS_KEY_ID}
          secret_access_key: ${AWS_SECRET_ACCESS_KEY}
        boltdb_shipper:
          active_index_directory: /loki/index
          shared_store: s3
          cache_location: /loki/cache
      
      # Enhanced limits for production
      limits_config:
        retention_period: 720h  # 30 days
        ingestion_rate_mb: 64
        ingestion_burst_size_mb: 128
        max_query_series: 1000000
        max_query_length: 12000h
        max_streams_per_user: 0
        max_global_streams_per_user: 0

# Enhanced Jaeger for production
jaeger:
  allInOne:
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
    
    # Use external storage (Elasticsearch) for production
    config:
      storage:
        type: elasticsearch
        elasticsearch:
          server-urls: http://elasticsearch.trii-monitoring.svc.cluster.local:9200
          index-prefix: jaeger

# Production ingress with enhanced security
ingress:
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/ssl-protocols: "TLSv1.2 TLSv1.3"
    nginx.ingress.kubernetes.io/ssl-ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
      add_header X-Frame-Options "DENY" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;
    # Rate limiting
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    # IP whitelisting for admin interfaces
    nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"

# Network policies for security
networkPolicies:
  enabled: true